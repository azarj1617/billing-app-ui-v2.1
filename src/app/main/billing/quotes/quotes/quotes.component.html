<div>
    <div class="row ms-1 justify-content-between" style="position: sticky;top:108px;background: #fff;height: 80px;">
        <div class="col-4">
            <form class="example-form">
                    <mat-form-field class="example-full-width" appearance="fill">
                        <input #customerInput type="text" id="customer-search"
                            matInput 
                            placeholder="Search Customer Details" 
                            [formControl]="customerForm"
                            [matAutocomplete]="auto1"
                            (input)="customerSearch($event)">
                            <mat-autocomplete 
                                #auto1="matAutocomplete"
                                [panelWidth]="'fit-content'"
                                autoActiveFirstOption
                                (optionSelected)="selectedCustomer($event.option)" 
                                appearance="fill">
                            <mat-option *ngFor="let option of customerList;" [value]="option?.customerId">
                                <div class="option-row">
                                    <div style="width: 10vw;"><span>{{ option.cusOldNo?option.cusOldNo:option?.customerId}}</span></div>
                                    <div style="width: 12vw;"><span>{{ option.customerFirstName}}</span><span *ngIf="option.customerLastName">{{" "+ option.customerLastName}}</span></div>
                                    <div style="width: 15vw;"><span>{{ option.address?option.address:''}}</span></div>
                                    <div style="width: 15vw;"><span>{{ option.mobile?option.mobile:''}}</span></div>
                                </div>
                            </mat-option>
                        </mat-autocomplete>
                    </mat-form-field>
                    </form>
            <div *ngIf="selectedCustomerDetails?.customerFirstName" class="customer-details">
                <p><span>{{selectedCustomerDetails?.customerFirstName}}</span>
                    <span *ngIf="selectedCustomerDetails?.customerLastName">{{" "+selectedCustomerDetails?.customerLastName}}</span>
                    <span *ngIf="selectedCustomerDetails?.mobile">{{" | " +selectedCustomerDetails?.mobile}}</span>
                    <span>{{" | "}}</span><span style="color: red;">{{(selectedCustomerDetails?.priceType==0)?"Retail":"Wholesale"}}</span>
                </p>
                <p>{{selectedCustomerDetails?.address}}</p>
            </div>
            <!-- <input class="form-control form-control-sm" type="text" placeholder="Customer Details"
                (input)="customerSearch($event)"> -->
        </div>
          <!-- <div class="col-1"></div> -->
        <div class="col-4 d-flex justify-content-center">
            <div style="text-align: center;">
               <label style="font-size: 20px;font-weight: 700;">Total Amount</label><br>
               <label style="font-size: 30px;font-weight: 900;">{{totalNetAmount | currency:'INR'}}</label>               
            </div>            
        </div>
        <div class="col-4 d-flex justify-content-end">
            <div class="d-flex me-3" style="font-weight: 500;">
                <label>Date</label>
                <label style="margin-left:4px">
                <input id="my-date-picker" (change)="getDateWiseQuoteList($event)" 
                    type="date" class="form-control" name="selectedDate"
                    [(ngModel)]="selectedDate" [max]="today">
                </label>
            </div>            
            <div class="me-3"> | </div>
            <div class="d-flex me-3" style="font-weight: 500;">
                <label>Quote No :</label>
                <label style="margin-left:4px">{{quoteNumber}}</label>
            </div>            
        </div>
    </div>
      <div class="row me-1 ms-1" style="height: 350px;overflow-y: scroll;">
        <div class="col-12">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>S.No</th>
                        <th>Item Name</th>
                        <th>Item Description</th>
                        <th>UOM</th>
                        <th>Qty</th>
                        <th style="text-align: right;">MRP</th>
                        <th style="width:110px;text-align: right;">
                            <span>Our Price</span>
                            <span style="margin-left: 5px;background: red;
                                border-radius: 50%;padding: 2px 4px;
                                color:#fff;font-size: 12px;">{{(selectedCustomerDetails?.priceType==1)?"W":"R"}}</span>
                        </th>
                        <th style="text-align: right;">Amount</th>
                        <th style="width:85px;text-align: center;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td></td>
                        <td>
                            <div>
                <form class="example-form">
                    <mat-form-field class="example-full-width" appearance="fill">
                        <input type="text" id="item-search"
                            matInput 
                            placeholder="Search Item" 
                            [formControl]="myControl"
                            [matAutocomplete]="auto"
                            (keydown)="eaCodeEnter($event)"
                            (input)="searchItems($event)">
                        
                            <mat-autocomplete 
                                #auto="matAutocomplete"
                                [displayWith]="displayFn"
                                [panelWidth]="'fit-content'"
                                (optionSelected)="selectItem($event.option)" 
                                appearance="fill">
                            <mat-option *ngIf="searchItemsList?.length>0" disabled class="mat-header">
                                <div class="option-row">
                                    <div class="col eac" style="font-weight: bold;">EA CODE</div>
                                    <div class="col name" style="font-weight: bold;">Item Name</div>
                                    <div class="col desc" style="font-weight: bold;">Item Description</div>
                                    <div class="col mrp" style="font-weight: bold;">MRP</div>
                                    <div class="col price" style="font-weight: bold;">Selling Price</div>
                                     <div class="col price" style="font-weight: bold;">Whole Sale Price</div>
                                </div>
                            </mat-option>
                            <mat-option *ngFor="let option of searchItemsList;" [value]="option?.itemId">

                                <div class="option-row">
                                    <div class="col eac">{{ option.eaCode }}</div>
                                    <div class="col name">{{ option.itemName }}</div>
                                    <div class="col desc">{{ option.itemDescription }}</div>
                                    <div class="col mrp">{{ option.priceDetails[0]?.mrp | currency : 'INR' }}</div>
                                    <div class="col price">{{ option.priceDetails[0]?.sellingPrice | currency : 'INR'}}</div>
                                    <div class="col price">{{ option.priceDetails[0]?.wholeSalePrice | currency : 'INR'}}</div>
                                </div>
                            </mat-option>
                        </mat-autocomplete>
                    </mat-form-field>
                    </form>
                    </div>
                        </td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr *ngFor="let item of itemList;let i=index">
                        <td>{{item.sno}}</td>
                        <td>
                            <!-- <input [id]="'itemName'+i" class="form-control form-control-sm" 
                                type="text" [(ngModel)]="item.itemName" (keydown)="itemChangeFun($event,item,i)"> -->
                    <form class="example-form">
                    <mat-form-field class="example-full-width" appearance="fill">
                        <input type="text" [id]="'itemName'+i"
                            matInput 
                            placeholder="Search Item" 
                            [matAutocomplete]="auto2"
                            (input)="searchItems($event,i)"
                            (keydown)="itemChangeFun($event,item,i)"
                            [value]="item.itemName"
                            [name]="'itemName' + i">
                        
                            <mat-autocomplete 
                               #auto2="matAutocomplete"
                                [displayWith]="displayFn"
                                [panelWidth]="'fit-content'"
                                (optionSelected)="changeItem($event.option,item,i)" 
                                appearance="fill">
                             <mat-option *ngIf="item?.searchItemsList?.length>0" disabled class="mat-header">
                                <div class="option-row">
                                    <div class="col eac" style="font-weight: bold;">EA CODE</div>
                                    <div class="col name" style="font-weight: bold;">Item Name</div>
                                    <div class="col desc" style="font-weight: bold;">Item Description</div>
                                    <div class="col mrp" style="font-weight: bold;">MRP</div>
                                    <div class="col price" style="font-weight: bold;">Selling Price</div>
                                     <div class="col price" style="font-weight: bold;">Whole Sale Price</div>
                                </div>
                            </mat-option>
                            <mat-option *ngFor="let option of item.searchItemsList;" [value]="option?.itemId">

                                <div class="option-row">
                                    <div class="col eac">{{ option.eaCode }}</div>
                                    <div class="col name">{{ option.itemName }}</div>
                                    <div class="col desc">{{ option.itemDescription }}</div>
                                    <div class="col mrp">{{ option.priceDetails[0]?.mrp | currency : 'INR' }}</div>
                                    <div class="col price">{{ option.priceDetails[0]?.sellingPrice | currency : 'INR'}}</div>
                                    <div class="col price">{{ option.priceDetails[0]?.wholeSalePrice | currency : 'INR'}}</div>
                                </div>
                            </mat-option>
                        </mat-autocomplete>
                    </mat-form-field>
                    </form>
                        </td>
                        <td>{{item.itemDescription}}</td>
                        <td>{{item.uom}}</td>
                        <td style="width:75px">
                            <input [id]="'qty'+i" class="form-control form-control-sm" type="text" 
                            [(ngModel)]="item.quantity" (keydown)="qtyChange($event,item,i)" (change)="qtyChange($event,item,i)" (input)="quantityChange($event,i)">
                        </td>
                        <td style="text-align: right;">{{item.mrp | number:'1.2-2'}}</td>
                        <td *ngIf="selectedCustomerDetails?.priceType==1;else retailPrice" style="text-align: right;">
                            <input [id]="'price'+i" class="form-control form-control-sm amout-field" type="text"
                             [(ngModel)]="item.wholeSalePrice" (change)="priceChange($event,item,i)" (keydown)="priceChange($event,item,i)" (input)="priceChange($event,item,i)">
                        </td>
                        <ng-template #retailPrice>
                            <td style="text-align: right;">
                            <input [id]="'price'+i" class="form-control form-control-sm amout-field" type="text"
                             [(ngModel)]="item.sellingPrice" (change)="priceChange($event,item,i)" (keydown)="priceChange($event,item,i)" (input)="priceChange($event,item,i)">
                        </td>
                        </ng-template>
                        <td style="text-align: right;">{{item.amount| number:'1.2-2'}}</td>
                        <td style="text-align: center;">
                            <button class="btn btn-sm me-1" [title]="'Delete Price'" (click)="delteItem(item,i)">
                                    <i class="fas fa-trash" style="color:red"></i></button>
                        </td>
                    </tr>
                </tbody>
                <!-- <tfoot class="table-footer">
                    <tr>
                        <td colspan="9">
                            <div class="d-flex">
                                <div class="ms-auto">
                                    <button class="btn btn-info">Save</button>
                                    <button class="btn btn-info ms-1">Clear</button>
                                </div>                                
                            </div>                            
                        </td>
                    </tr>
                </tfoot> -->
            </table>
        </div>
    </div>
    <div class="row table-footer">
        <div class="d-flex">
            <div class="ms-auto">
                <button *ngIf="this.selectedQuote?.quoteId" class="btn btn-info" (click)="quotePrint()">Print</button>
                <button class="btn btn-info ms-1" [disabled]="itemList?.length==0" (click)="confirmation()">Save</button>
                <button class="btn btn-info ms-1" (click)="quoteClear()">Clear</button>
            </div>                                
        </div> 
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="multi-price" tabindex="-1" aria-labelledby="multi-price-modalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered"> <!-- optional: centered modal -->
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title" id="multi-price-modalLabel">Select Price</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">
        <div> 
                <table class="table table-responsive table-hover">
                        <thead>
                        <tr>
                            <th>MRP</th>
                            <th>Selling Price</th>
                            <th>Whole Sale Price</th>
                        </tr>
                        </thead>
                    <tbody>
                     <tr *ngFor="let price of multiPriceList;">
                        <td>{{price?.mrp}}</td>
                        <td>{{price?.sellingPrice}}</td>
                        <td>{{price?.wholeSalePrice}}</td>
                    </tr>
                    </tbody>
                </table>
        </div>
    </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>

<div *ngIf="quotationList?.length>0" class="overlay-container">
  <div style="position: sticky;top:0;background: #fff;"> 
    <div class="mt-2">
        <div class="d-flex justify-content-end">
            <button class="btn btn-close btn-sm" (click)="quotationList=[]"></button>
        </div>
    </div>
    <div class="mt-2">
        <label>
        Quotation Details
        </label>
    </div>
    <div class="d-flex">
        <div style="width: 10vw;"><label style="font-weight: bold;">Quote No.</label></div>
        <div style="width: 10vw;"><label style="font-weight: bold;">Customer Name</label></div>
        <div style="width: 10vw;text-align:right!important;"><label style="font-weight: bold;">Amount</label></div>
        <div style="width: 10vw;text-align:right!important;"><label style="font-weight: bold;">Actions</label></div>
    </div>
    </div>
   <div class="d-flex quote-row" *ngFor="let quote of quotationList;let i=index">
     <div style="width: 10vw;" (click)="quoteSelect(quote,i)"><label>{{quote?.dailyQuoteNo}}</label></div>
      <div style="width: 10vw;" (click)="quoteSelect(quote,i)">
        <label *ngIf="quote?.customer?.length > 0">
            {{
            (quote.customer[0]?.customerFirstName || '') +
            (quote.customer[0]?.customerLastName ? ' ' + quote.customer[0].customerLastName : '')
            }}
        </label>
        </div>

        <div style="width: 10vw;text-align: right;" (click)="quoteSelect(quote,i)">
            <label>{{quote?.totalAmount | currency:'INR'}}</label></div>
         <div style="width: 10vw;text-align: right;">
            <button class="btn btn-xs btn-light" (click)="quotePrint(quote,i)"><i class="fas fa-print"></i></button>
         </div>
    </div>
    <div class="d-flex quote-row">
     <div style="width: 10vw;"></div>
     <div style="width: 10vw;"><label style="font-weight: bold;">Total</label></div>
     <div style="width: 10vw;text-align: right;">
            <label style="font-weight: bold;">{{totalQuoteAmount | currency:'INR'}}</label></div>
     <div style="width: 10vw;text-align: right;"></div>
    </div>
                 
</div>

<div class="dropdown-panel" *ngIf="showPanel" [style.bottom.px]="panelBottom" [style.right.px]="panelright">
  <table class="dropdown-table">
    <tr>
        <th>EA Code</th>
        <th>Item Name</th>
        <th style="text-align: right;">MRP</th>
        <th style="text-align: right;">Retail Price</th>
        <th style="text-align: right;">Wholesale Price</th>
    </tr>
    <tr *ngFor="let row of multiPriceList; let i = index"
        [class.active]="i === selectedIndex"
        (click)="selectRow(row,i)">
      <td>{{ tempselectedItem.eaCode }}</td>
      <td>{{ tempselectedItem.itemName }}</td>
      <!-- <td>{{ tempselectedItem.itemDescription }}</td> -->
      <td style="text-align: right;">{{ row.mrp | number:'1.2-2' }}</td>
      <td style="text-align: right;">{{ row.sellingPrice | number:'1.2-2' }}</td>
      <td style="text-align: right;">{{ row.wholeSalePrice | number:'1.2-2' }}</td>
    </tr>
  </table>
</div>

<!--Item Master Modal-->
<div class="modal fade" id="item-master-modal" tabindex="-1" aria-labelledby="item-master-modalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="item-master-modalLabel">{{modelTitle}}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="itemMasterForm" class="mb-3">
          <div class="mb-1">
            <label for="recipient-name" class="col-form-label">Item Name</label>
            <input type="text" class="form-control" formControlName="itemName">
          </div>
          <div class="mb-1">
            <label for="message-text" class="col-form-label">Item Description</label>
            <input type="text" class="form-control" formControlName="itemDescription">
          </div>
           <div class="row mb-1">
            <div class="col-md-6">
                <label for="message-text" class="col-form-label">UOM</label>
                <input type="text" class="form-control" formControlName="uom">
            </div>
            <div class="col-md-6">
                <label for="message-text" class="col-form-label">EAC</label>
                <input type="text" class="form-control" formControlName="eaCode">
            </div>
          </div>
          </form>
          <table>
                <thead>
                    <tr style="font-size: 12px;">
                        <th>MRP</th>
                        <th>Selling Price</th>
                        <th>Whole Sale Price</th>
                        <th>Cost</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let price of priceList">
                        <td><input type="text" class="form-control" (change)="itemPriceChange()"
                            [(ngModel)]="price.mrp" style="height:25px" 
                            oninput="this.value = this.value.replace(/[^0-9.]/g, '')"></td>
                        <td><input type="text" class="form-control" (change)="itemPriceChange()"
                            [(ngModel)]="price.sellingPrice" style="height:25px"
                            oninput="this.value = this.value.replace(/[^0-9.]/g, '')"></td>
                        <td><input type="text" class="form-control" (change)="itemPriceChange()"
                            [(ngModel)]="price.wholeSalePrice" style="height:25px"
                            oninput="this.value = this.value.replace(/[^0-9.]/g, '')"></td>
                        <td><input type="text" class="form-control" (change)="itemPriceChange()"
                            [(ngModel)]="price.costPrice" style="height:25px"
                            oninput="this.value = this.value.replace(/[^0-9.]/g, '')"></td>
                        <td>
                            <button class="btn btn-sm me-1" [title]="'Delete Price'" (click)="deltePrice(price)">
                                    <i class="fas fa-trash" style="color:red"></i></button>
                        </td>
                        
                    </tr>
                    <tr>
                        <td>
                            <button class="btn btn-sm btn-info mt-2" 
                                (click)="addPrice()" [disabled]="isNoAddPriceBtn">Add Price</button>
                        </td>
                    </tr>
                </tbody>
          </table>
          <div class="mt-3">
            <label for="">Status</label>
            <div class="form-check mt-1">
            <input class="form-check-input" type="checkbox" [(ngModel)]="this.itemMasterForm.value.status">
            <label class="form-check-label" for="flexCheckDefault">
                Active
            </label>
            </div>
        </div>          
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-sm btn-info" (click)="saveItem()">Save</button>
        <button type="button" class="btn btn-sm btn-secondary" (click)="modalClose('item-master-modal')">Close</button>
      </div>
    </div>
  </div>
  <div id="closeBtn"></div>
</div>
<app-confirm-action [config]="confirmActionConfig" (action)="confirmActionFun($event)">
</app-confirm-action>
